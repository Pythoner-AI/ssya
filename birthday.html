<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <title>ç”Ÿæ—¥å¿«ä¹</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{
            font-family:'Microsoft YaHei',sans-serif;
            background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);
            overflow:hidden;height:100vh;
            position:relative
        }
        #wrapper{width:100vw;height:100vh;position:relative}
        #background{position:absolute;top:0;left:0;width:100%;height:100%;z-index:1}

        /* èƒŒæ™¯å…ƒç´ æ ·å¼ */
        .star{position:absolute;background:white;border-radius:50%;animation:twinkle 3s infinite ease-in-out}
        .birthday-element{position:absolute;animation:float 20s infinite linear}
        .birthday-text{
            position:absolute;white-space:nowrap;
            font-weight:bold;color:#ff4081;text-shadow:0 0 10px currentColor;
            animation:bounce 2s infinite ease-in-out
        }

        @keyframes twinkle{0%,100%{opacity:.2}50%{opacity:1}}
        @keyframes float{0%{transform:translateY(100vh) rotate(0deg)}100%{transform:translateY(-100px) rotate(360deg)}}
        @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}

        /* ä¸»çª—å£æ ·å¼ */
        #firstWindow{
            position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
            width:80vw;max-width:320px;height:35vh;
            background:linear-gradient(145deg,rgba(255,105,180,.9),rgba(255,182,193,.9));
            border:3px solid white;border-radius:20px;
            display:flex;flex-direction:column;justify-content:center;align-items:center;
            z-index:1000
        }
        #firstWindow h1{color:white;font-size:26px;margin-bottom:10px}
        #startBtn{
            padding:12px 30px;
            background:linear-gradient(45deg,#32CD32,#90EE90);
            border:2px solid white;border-radius:25px;
            color:white;font-size:16px;font-weight:bold;
            cursor:pointer
        }

        /* æç¤ºçª—å£ */
        .tip-window{
            position:absolute;white-space:nowrap;
            background:linear-gradient(135deg,var(--bg-color),var(--bg-light));
            border:2px solid white;border-radius:12px;
            padding:8px 12px;
            display:flex;align-items:center;justify-content:center;
            animation:fadeIn .5s;
            z-index:10; /* ç¡®ä¿çª—å£åœ¨èƒŒæ™¯å…ƒç´ ä¸Šæ–¹ */
        }
        @keyframes fadeIn{from{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}

        /* é¢œè‰²å®šä¹‰ */
        .color-1{--bg-color:#ff9a9e;--bg-light:#fad0c4}
        .color-2{--bg-color:#a1c4fd;--bg-light:#c2e9fb}
        .color-3{--bg-color:#84fab0;--bg-light:#8fd3f4}
        .color-4{--bg-color:#ffecd2;--bg-light:#fcb69f}
        .color-5{--bg-color:#fbc2eb;--bg-light:#a6c1ee}

        /* åŠ è½½æç¤º */
        #loadingTip{
            position:absolute;top:0;left:0;width:100%;height:100%;
            background:rgba(0,0,0,.8);color:white;
            display:flex;flex-direction:column;justify-content:center;align-items:center;
            z-index:9999
        }
        .loader{width:48px;height:48px;border:5px solid #fff;border-bottom-color:#ff4081;border-radius:50%;animation:rotation 1s linear infinite;margin-bottom:20px}
        @keyframes rotation{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}

        /* å“åº”å¼é€‚é… */
        @media screen and (max-width:768px){
            .tip-window{font-size:14px;padding:10px 15px}
            .birthday-text{font-size:5vw;margin:0 5px}
            #audioCtrl{position:absolute;bottom:15px;left:50%;transform:translateX(-50%);z-index:999}
        }
        @media screen and (min-width:769px){
            #audioCtrl{display:none} /* ç”µè„‘ç«¯éšè—éŸ³é¢‘æ§ä»¶ */
        }
    </style>
</head>
<body>
    <div id="wrapper">
        <div id="loadingTip"><div class="loader"></div><p>å‡†å¤‡ä¸­...</p></div>
        <div id="background"></div>
        <div id="firstWindow">
            <h1>oiï¼æ´¾å¤§æ˜Ÿ</h1>
            <button id="startBtn">å¼€å§‹æƒŠå–œ</button>
        </div>
        <!-- éŸ³é¢‘æ§ä»¶ï¼ˆç§»åŠ¨ç«¯æ˜¾ç¤ºï¼‰ -->
        <div id="audioCtrl" style="display:none">
            <audio id="m" loop preload="metadata">
                <!-- ä¸»éŸ³é¢‘æº -->
                <source src="ç”Ÿæ—¥æ­Œ.mp3" type="audio/mp3">
            </audio>
        </div>
    </div>

    <script>
        // æ ¸å¿ƒæ•°æ®
        const tips = ['å¤šå–æ°´å“¦~','ä¿æŒå¾®ç¬‘å‘€','æ¯å¤©å…ƒæ°”æ»¡æ»¡','è®°å¾—åƒæ°´æœ','ä¿æŒå¥½å¿ƒæƒ…','å¥½å¥½çˆ±è‡ªå·±','å¿ƒæƒ³äº‹æˆ','æ¢¦æƒ³æˆçœŸ','å¤©å¤©å‘ä¸Š','é¡ºé¡ºåˆ©åˆ©','æ—©ç‚¹ä¼‘æ¯','åˆ«ç†¬å¤œ','å¼€å¿ƒæ¯ä¸€å¤©','å¤©å†·åŠ è¡£','æ™šå®‰'];
        const colorClasses = ['color-1','color-2','color-3','color-4','color-5'];
        const birthdayColors = ['#ff4081','#ff9800','#4caf50','#2196f3','#9c27b0'];
        const birthdayTexts = ['ç”Ÿæ—¥å¿«ä¹','Happy Birthday','ç”Ÿæ—¥å¤§å¿«ä¹','å¤©å¤©å¼€å¿ƒ'];

        // DOMå…ƒç´ 
        const elements = ['m','loadingTip','firstWindow','startBtn','background','wrapper','audioCtrl']
            .reduce((obj, id) => {
                obj[id] = document.getElementById(id);
                return obj;
            }, {});
        const {m, loadingTip, firstWindow, startBtn, background, wrapper, audioCtrl} = elements;

        const isMobile = window.innerWidth < 768;
        let windows = [], currentTipIndex = 0, isAudioPlaying = false;

        // é…ç½®å‚æ•° - ä¼˜åŒ–çª—å£å¸ƒå±€
        const config = {
            gap: isMobile ? 40 : 50,  // å¢å¤§ç§»åŠ¨ç«¯é—´è·
            tipFontSize: isMobile ? '14px' : '16px',
            starCount: isMobile ? 40 : 80,
            floatCount: isMobile ? 3 : 8,
            totalWindows: 100,  // æ”¹ä¸º100ä¸ªçª—å£
            interval: isMobile ? 1000 : 600,  // å‡æ…¢åˆ›å»ºé€Ÿåº¦ï¼Œé™ä½é‡å æ¦‚ç‡
            maxAttempts: 200  // å¢åŠ ä½ç½®æŸ¥æ‰¾å°è¯•æ¬¡æ•°
        };

        // åˆå§‹åŒ–
        window.onload = () => {
            if (isMobile) audioCtrl.style.display = 'block';
            setTimeout(createStars, 100);
            setTimeout(createFloatElements, 300);
            setTimeout(createBirthdayTexts, 500);
            bindAudioEvents();

            setTimeout(() => {
                loadingTip.style.transition = 'opacity 0.5s ease';
                loadingTip.style.opacity = 0;
                setTimeout(() => loadingTip.style.display = 'none', 500);
            }, 1000);
        };

        // éŸ³é¢‘äº‹ä»¶å¤„ç†
        function bindAudioEvents() {
            const playAudio = () => {
                if (!isAudioPlaying) {
                    m.muted = false;
                    m.volume = isMobile ? 0.8 : 1;
                    m.play().then(() => {
                        isAudioPlaying = true;
                        if (isMobile) audioCtrl.style.opacity = 0.3;
                    }).catch(err => {
                        console.log('éŸ³é¢‘æ’­æ”¾å¤±è´¥:', err);
                        if (isMobile) audioCtrl.style.opacity = 1;
                    });
                }
                document.removeEventListener('click', playAudio);
                document.removeEventListener('touchstart', playAudio);
            };

            document.addEventListener('click', playAudio);
            document.addEventListener('touchstart', playAudio, {passive: true});
            startBtn.addEventListener('click', playAudio);
        }

        // åˆ›å»ºæ˜Ÿæ˜ŸèƒŒæ™¯
        function createStars() {
            for (let i = 0; i < config.starCount; i++) {
                const star = document.createElement('div');
                const size = Math.random() * 2 + 1;
                star.className = 'star';
                star.style.cssText = `
                    width:${size}px;height:${size}px;
                    left:${Math.random()*100}%;top:${Math.random()*100}%;
                    animation-delay:${Math.random()*3}s
                `;
                background.appendChild(star);
            }
        }

        // åˆ›å»ºæ¼‚æµ®å…ƒç´ 
        function createFloatElements() {
            ['ğŸˆ','ğŸ','ğŸ‚'].forEach((emoji, i) => {
                for (let j = 0; j < config.floatCount; j++) {
                    const el = document.createElement('div');
                    el.className = 'birthday-element';
                    el.innerHTML = emoji;
                    el.style.cssText = `
                        font-size:${isMobile ? 18+i*2 : 25+i*5}px;
                        color:${birthdayColors[Math.floor(Math.random()*birthdayColors.length)]};
                        left:${Math.random()*100}%;
                        animation-delay:${Math.random()*20}s
                    `;
                    background.appendChild(el);
                }
            });
        }

        // åˆ›å»ºç”Ÿæ—¥æ–‡å­—ï¼ˆé˜²é‡å ï¼‰
        function createBirthdayTexts() {
            const containerWidth = window.innerWidth;
            const textPositions = [];

            birthdayTexts.forEach((text, i) => {
                const el = document.createElement('div');
                el.className = 'birthday-text';
                el.textContent = text;
                el.style.fontSize = isMobile ? '5vw' : '28px';
                el.style.color = birthdayColors[i % birthdayColors.length];
                el.style.animationDelay = `${i * 0.3}s`;

                document.body.appendChild(el);
                const textWidth = el.offsetWidth;
                document.body.removeChild(el);

                let leftPos, attempts = 0, valid = false;
                while (!valid && attempts < 20) {
                    leftPos = Math.max(20, Math.random() * (containerWidth - textWidth - 40));
                    valid = textPositions.every(pos =>
                        leftPos + textWidth < pos.left || leftPos > pos.left + pos.width
                    );
                    attempts++;
                }

                textPositions.push({left: leftPos, width: textWidth});
                el.style.left = `${leftPos}px`;
                el.style.top = `${15 + i * 18}%`;
                background.appendChild(el);
            });
        }

        // å¼€å§‹æŒ‰é’®äº‹ä»¶
        startBtn.onclick = () => {
            firstWindow.style.display = 'none';
            // åˆ†æ‰¹æ¬¡åˆ›å»º100ä¸ªçª—å£ï¼Œæ¯æ‰¹10ä¸ªï¼Œå‡è½»æ€§èƒ½å‹åŠ›
            for (let batch = 0; batch < 10; batch++) {
                for (let i = 0; i < 10; i++) {
                    const delay = (batch * 10 + i) * config.interval;
                    setTimeout(createWindow, delay);
                }
            }
        };

        // çª—å£ä½ç½®éªŒè¯ï¼ˆå¢å¼ºç‰ˆï¼‰
        function validPos(x, y, width, height) {
            const {innerWidth: w, innerHeight: h} = window;
            // è¾¹ç•Œæ£€æŸ¥æ›´ä¸¥æ ¼
            if (x < 20 || y < 20 || x + width > w - 20 || y + height > h - 20)
                return false;

            // ä¸æ‰€æœ‰å·²æœ‰çª—å£ä¿æŒè·ç¦»
            return windows.every(win => {
                const r = win.getBoundingClientRect();
                // å¢åŠ è·ç¦»é˜ˆå€¼ï¼Œé¿å…è¾¹ç¼˜é‡å 
                return Math.hypot(x - r.left, y - r.top) > (width + config.gap) * 0.9;
            });
        }

        // è·å–çª—å£ä½ç½®ï¼ˆä¼˜åŒ–ç®—æ³•ï¼‰
        function getPos(width, height) {
            const {innerWidth: w, innerHeight: h} = window;
            let attempts = 0;

            // å…ˆå°è¯•åœ¨ç©ºç™½åŒºåŸŸåˆ›å»º
            while (attempts++ < config.maxAttempts) {
                // åˆ†åŒºåŸŸéšæœºï¼Œé¿å…é›†ä¸­åœ¨ä¸­å¿ƒ
                let region = Math.floor(Math.random() * 4);
                let x, y;

                // æŒ‰åŒºåŸŸç”Ÿæˆä½ç½®ï¼Œåˆ†æ•£çª—å£
                switch(region) {
                    case 0: // å·¦ä¸Š
                        x = 20 + Math.random() * (w/2 - width - 40);
                        y = 20 + Math.random() * (h/2 - height - 40);
                        break;
                    case 1: // å³ä¸Š
                        x = w/2 + Math.random() * (w/2 - width - 40);
                        y = 20 + Math.random() * (h/2 - height - 40);
                        break;
                    case 2: // å·¦ä¸‹
                        x = 20 + Math.random() * (w/2 - width - 40);
                        y = h/2 + Math.random() * (h/2 - height - 40);
                        break;
                    case 3: // å³ä¸‹
                        x = w/2 + Math.random() * (w/2 - width - 40);
                        y = h/2 + Math.random() * (h/2 - height - 40);
                        break;
                }

                if (validPos(x, y, width, height)) return {x, y};
            }

            // å¤šæ¬¡å°è¯•å¤±è´¥åï¼Œå¼ºåˆ¶æ”¾åœ¨æœ€è¾¹ç¼˜
            return {
                x: Math.min(20 + Math.random() * (w - width - 40), w - width - 20),
                y: Math.min(20 + Math.random() * (h - height - 40), h - height - 20)
            };
        }

        // åˆ›å»ºæç¤ºçª—å£
        function createWindow() {
            if (currentTipIndex >= tips.length) currentTipIndex = 0;
            const tipText = tips[currentTipIndex];

            // è®¡ç®—çª—å£å°ºå¯¸
            const tempWin = document.createElement('div');
            tempWin.className = 'tip-window';
            tempWin.style.visibility = 'hidden';
            tempWin.style.fontSize = config.tipFontSize;
            tempWin.innerHTML = `<div style="color:#333;font-weight:bold;">${tipText}</div>`;
            document.body.appendChild(tempWin);

            const width = tempWin.offsetWidth;
            const height = tempWin.offsetHeight;
            document.body.removeChild(tempWin);

            // è·å–ä½ç½®å¹¶åˆ›å»ºçª—å£
            const {x, y} = getPos(width, height);
            const win = document.createElement('div');
            win.className = `tip-window ${colorClasses[Math.floor(Math.random()*colorClasses.length)]}`;
            win.style.left = `${x}px`;
            win.style.top = `${y}px`;
            win.style.fontSize = config.tipFontSize;
            win.innerHTML = `<div style="color:#333;font-weight:bold;">${tipText}</div>`;
            wrapper.appendChild(win);
            windows.push(win);

            currentTipIndex++;
        }

        // é”™è¯¯æ•è·
        window.addEventListener('error', (e) => {
            console.error('é¡µé¢é”™è¯¯:', e);
            loadingTip.style.opacity = 0;
            setTimeout(() => loadingTip.style.display = 'none', 500);
        });
    </script>
</body>
</html>